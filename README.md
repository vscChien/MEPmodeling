## A Biological Model of Spinal and Peripheral Motor Pathways for TMS-induced MEPs

This repository provides tools to model and analyze **motor-evoked potentials (MEPs)** generated by **transcranial magnetic stimulation (TMS)**.  
The workflow involves three main steps:

1. **Load experimental data** ‚Äì Import MEP waveforms recorded under different TMS intensities [1].  
2. **Generate model inputs** ‚Äì Simulate DI-waves based on the given TMS intensities.  
3. **Optimize model parameters** ‚Äì Fit the model to experimental MEP waveforms using optimization techniques.


[1] Sorkhabi, M. M., Wendt, K., O'Shea, J., & Denison, T. (2022, April 9). *EMG data for Pulse width modulation-based TMS: Primary Motor Cortex Responses compared to Conventional Monophasic Stimuli.*
DOI: [10.1016/j.brs.2022.06.013](https://doi.org/10.1016/j.brs.2022.06.013)  
**MEP dataset**: [https://osf.io/5ry92/](https://osf.io/5ry92/)

## ü•ó Model Evaluation

To **evaluate model performance**, we compared **three different models** in terms of their goodness-of-fit to experimental MEP waveforms.

1. **Biological model (with Renshaw cells)**: The motor-unit action potentials (MUAPs) are triggered by spikes of the motor neurons (MNs) that interact with Renshaw cells (RC). 
2. **Biological model (without Renshaw cells)**: The MUAPs are triggered by spikes of the MNs.  
3. **Phenomenological model**: The MUAPs are triggered by spikes that follow a [gamma ditribution](https://en.wikipedia.org/wiki/Gamma_distribution).

üìÇ Detailed scripts and analysis can be found in the [`scripts/`](scripts/) directory.


<p align="center">
  <a href="model_description.pdf">
    <img src="model_description.png" alt="Click to view PDF" width="400">
  </a>
</p>

## Folder Structure
```bash
üìÇ MEPmodeling
‚îú‚îÄ‚îÄ README.md             # This file
‚îú‚îÄ‚îÄ GA/                   # Genetic algorithm toolbox
‚îú‚îÄ‚îÄ data_Oxford_MEP/      # Data (MEP dataset)
‚îú‚îÄ‚îÄ data_MUAP/            # Data (Motor unit action potentials)
‚îú‚îÄ‚îÄ MyelinatedAxonModel/  # Data (Extracellular potential)
‚îú‚îÄ‚îÄ fitted_results/      
‚îÇ   ‚îú‚îÄ‚îÄ bio/              # Biological model (with Renshaw cells)
‚îÇ   ‚îú‚îÄ‚îÄ bioNoRC/          # Biological model (without Renshaw cells)
‚îÇ   ‚îî‚îÄ‚îÄ pheno/            # Phenomenological model
‚îî‚îÄ‚îÄ scripts/              # Matlab scripts
    ‚îî‚îÄ‚îÄ figures/          

```

## Matlab Demo Script
### 1Ô∏è‚É£ Biological model
```matlab
subj       = 1;  % subject 1‚Äì10
withRC     = 1;  % 0: biological model without RC 
                 % 1: biological model with RC
AMPAweight = []; % []:free parameter range [0,1]
                 %    or a fixed value within [0,1]               
reRun      = 0;  % 0: Load fitted result and plot simulated MEP.  
                 % 1: Rerun model fitting. Back up previous fitted result
ga_MEPmodel_bio(subj,withRC,AMPAweight,reRun);
```
<p align="center">
  <a href="scripts/figures/demo_s1_bio_panel.png">
    <img src="scripts/figures/demo_s1_bio_panel.png" alt="Click to view PDF" width="800">
  </a>
</p>

### 2Ô∏è‚É£ Biological model (no Renshaw cells)
```matlab
subj       = 1;  % subject 1‚Äì10
withRC     = 0;  % 0: biological model without RC 
                 % 1: biological model with RC
AMPAweight = []; % []:free parameter range [0,1]
                 %    or a fixed value within [0,1]               
reRun      = 0;  % 0: Load fitted result and plot simulated MEP.  
                 % 1: Rerun model fitting. Back up previous fitted result
ga_MEPmodel_bio(subj,withRC,AMPAweight,reRun);
```
<p align="center">
  <a href="scripts/figures/demo_s1_noRC_panel.png">
    <img src="scripts/figures/demo_s1_noRC_panel.png" alt="Click to view PDF" width="800">
  </a>
</p>

### 3Ô∏è‚É£ Phenomenological model
```matlab
subj       = 1; % subject 1‚Äì10
reRun      = 0; % 0: Load fitted result and plot simulated MEP.  
                % 1: Rerun model fitting. Back up previous fitted result
ga_MEPmodel_pheno(subj,reRun);
```
<p align="center">
  <a href="scripts/figures/demo_s1_pheno_panel.png">
    <img src="scripts/figures/demo_s1_pheno_panel.png" alt="Click to view PDF" width="800">
  </a>
</p>
